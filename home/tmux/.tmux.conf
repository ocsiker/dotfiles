# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
        | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
        bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
        bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
        bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
        bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'
        tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
        if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
                "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
                if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
                        "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"

# bind-key -T copy-mode-vi 'C-h' select-pane -L
# bind-key -T copy-mode-vi 'C-j' select-pane -D
# bind-key -T copy-mode-vi 'C-k' select-pane -U
# bind-key -T copy-mode-vi 'C-l' select-pane -R
# bind-key -T copy-mode-vi 'C-\' select-pane -l
# navigation
set -g @tmux-nvim-navigation true
set -g @tmux-nvim-navigation-cycle true
set -g @tmux-nvim-navigation-keybinding-left 'C-h'
set -g @tmux-nvim-navigation-keybinding-down 'C-j'
set -g @tmux-nvim-navigation-keybinding-up 'C-k'
set -g @tmux-nvim-navigation-keybinding-right 'C-l'

# set -g utf8 on
# set -g status-utf8 on
# resize
set -g @tmux-nvim-resize true
set -g @tmux-nvim-resize-step-x 1
set -g @tmux-nvim-resize-step-y 1
set -g @tmux-nvim-resize-keybinding-left 'M-h'
set -g @tmux-nvim-resize-keybinding-down 'M-j'
set -g @tmux-nvim-resize-keybinding-up 'M-k'
set -g @tmux-nvim-resize-keybinding-right 'M-l'

# resize the pane
# resize the pane
bind-key -r J resize-pane -D 3
bind-key -r K resize-pane -U 3
bind-key -r H resize-pane -L 3
bind-key -r L resize-pane -R 3
#/fix escape delay set -sg escape-time 0

# toogle fullscreen pane 
bind-key -n 'C-f' resize-pane -Z

#bind key for select window 
# for image.nvim
# link https://github.com/3rd/image.nvim
#set -g utf8 on
set -gq allow-passthrough on
set -g visual-activity off
#
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -sel clip -i"
# set -g terminal-overrides '*,xterm-256color:Tc'
set -g default-terminal "tmux-256color"
# show list pane and quick select
# bind-key Space display-popup -E "~/bin/tmux-pane-menu.sh"
# Logic mới:
# 1. Gán kết quả fzf vào biến 'val'
# 2. Kiểm tra nếu biến 'val' có dữ liệu (-n "$val") thì mới set-buffer và paste
# 3. Dùng dấu nháy đơn '...' bao quanh toàn bộ lệnh để tránh xung đột ký tự đặc biệt

bind-key C-h display-popup -w 80% -h 70% -E 'val=$(grep -v "^$" ~/.sqlcl/history.log | sed -E "s/^[^:]+:[^:]+:[^:]+:[^:]+://" | fzf --tac --no-sort --preview "echo {} | bat --language=sql --style=plain --color=always" --preview-window=top:wrap:30%); if [ -n "$val" ]; then tmux set-buffer "$val"; tmux paste-buffer; fi'
# bind -n C-Space display-popup -E "tmux-pane-menu.sh"
bind Space display-popup -E "tmux-pane-menu.sh"

set -g visual-activity on
set -gq allow-passthrough on

# mo title de hien thi
set -g set-titles on
#set not auto rename window
#set allow-rename on - so your manual setting of window title can be overridden,
# set automatic-rename on - when you want tmux itself to set window name and title through its mechanism of terminal inspection
# set automatic-rename off - when you want to control window name and title from terminal (for example from a shell prompt)
# set-option -g allow-rename off
set-option -g automatic-rename off
#//set vim global
setw -g mode-keys vi

# set -g default-terminal "tmux-256color"
## Proper colors
# set-option -sa terminal-features ',alacritty:RGB'

# Undercurl

set-option -g default-command bash
set -g @continuum-restore 'on'

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
# tmux-fzf
set -g @plugin 'sainnhe/tmux-fzf'
#auto restore session tmux
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Other examples:
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'github_username/plugin_name#branch'
# set -g @plugin 'git@github.com:user/plugin'
# set -g @plugin 'git@bitbucket.com:user/plugin'
# set -g @plugin 'aserowy/tmux.nvim'


run '~/.tmux/plugins/tpm/tpm'
# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
